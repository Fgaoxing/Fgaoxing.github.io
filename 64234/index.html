<!DOCTYPE html><html lang=zh-cn,zh-tw,en,default><head><meta http-equiv=content-type content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><title>FastJump.js - 动荡の初二少年</title><link rel="shortcut icon" href=https://npm.elemecdn.com/ytblogimg/webp/logo.webp><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://cdn2.chuqis.com/gh/Fgaoxing/blog-cdn@main/grid.css><script src=/js/js.js></script><meta http-equiv=X-UA-Compatible content="IE=Edge,chrome=1"><meta desc name=description content=动荡の初二少年的blog,动荡の初二少年的博客><meta property=og:description content="110行写了个小玩意，可以像sw那样离线缓存，和Pjax类似，不过用了自主缓存，fetch做请求，算了上代码吧：self.CACHE_NAME = &amp;#x27;FastJumpCache&amp;#x27;; // 默认的存储名称self.db = &amp;#123;    read: (key) =&amp;gt; &amp;#123;        return new Promise((resolve, r..."><meta name=description content="110行写了个小玩意，可以像sw那样离线缓存，和Pjax类似，不过用了自主缓存，fetch做请求，算了上代码吧：self.CACHE_NAME = &amp;#x27;FastJumpCache&amp;#x27;; // 默认的存储名称self.db = &amp;#123;    read: (key) =&amp;gt; &amp;#123;        return new Promise((resolve, r..."><meta name=keywords content="
"><meta name=description content="110行写了个小玩意，可以像sw那样离线缓存，和Pjax类似，不过用了自主缓存，fetch做请求，算了上代码吧： self.CACHE_NAME &#x3D; &amp;#x27;FastJumpCache&amp;#x27;; &#x2F;&#x2F; 默认的存储名称 self.db &#x3D; &amp;#123;     read: (key) &#x3D;&gt; &amp;#123;         return new Promise((resolve, reje"><meta property=og:type content=article><meta property=og:title content=FastJump.js><meta property=og:url content=https://www.yt-blog.top/64234/index.html><meta property=og:site_name content=动荡の初二少年><meta property=og:description content="110行写了个小玩意，可以像sw那样离线缓存，和Pjax类似，不过用了自主缓存，fetch做请求，算了上代码吧： self.CACHE_NAME &#x3D; &amp;#x27;FastJumpCache&amp;#x27;; &#x2F;&#x2F; 默认的存储名称 self.db &#x3D; &amp;#123;     read: (key) &#x3D;&gt; &amp;#123;         return new Promise((resolve, reje"><meta property=og:locale content=zh_CN><meta property=article:published_time content=2023-03-17T08:29:45.000Z><meta property=article:modified_time content=2023-05-25T13:19:16.885Z><meta property=article:author content=动荡の初二少年><meta property=article:tag content=动荡の初二少年><meta name=twitter:card content=summary><script>Jian.load.css("https://npm.elemecdn.com/@fortawesome/fontawesome-free@v6/css/all.min.css"),Jian.load.js("https://cdn2.chuqis.com/gh/Fgaoxing/Tool-js@main/tool.js",function(){TombSweepingDay(),Memorial(),lantern()}),Jian.load.js("https://npm.elemecdn.com/pandown",function(){pandown()})</script><script type=text/javascript>!function(t,e,n,a,c,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(c=e.createElement(a)).async=1,c.src="https://www.clarity.ms/tag/aarb47bzd1",(r=e.getElementsByTagName(a)[0]).parentNode.insertBefore(c,r)}(window,document,"clarity","script")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?597c75e8a1aca9c1525229b69d9c9ecc",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><meta name=follow.it-verification-code content=LlmddNY7dr0ZbV24UdUh><meta name=360-site-verification content=6e6223d4a72a81e520e67080db00fda6><meta name=baidu-site-verification content=codeva-Oz6pd5JcaV><meta name=generator content="Hexo 7.0.0-rc1"><link rel=alternate href=/atom.xml title=动荡の初二少年 type=application/atom+xml></head><body><script>Jian.onload.add(function(){var e=document.getElementsByTagName("img");for(i in e)e[i].setAttribute&&(e[i].setAttribute("lazyload",e[i].src),e[i].src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxMAAAsTAQCanBgAAAANSURBVBhXY2BgYGAAAAAFAAGKM+MAAAAAAElFTkSuQmCC");document.addEventListener("scroll",function(){Jian.onload.add(Jian.plugins.lazyload)}),Jian.plugins.lazyload()}),Jian.load.css("https://cdn2.chuqis.com/gh/dracula/highlightjs@master/dracula.css"),Jian.load.js("/js/highlight.min.js",function(){if(!document.getElementsByTagName("article")[0])return 0;let t=document.getElementsByTagName("article")[0].getElementsByTagName("code");for(l in t)t[l].classList&&t[l].classList.forEach(function(e){"highlightjs"!=e&&"hljs"!=e&&"hl"!=e&&"highlight"!=e&&t[l].classList.add("language-"+e)});hljs.highlightAll()}),Jian.cache={name:"StaticCache",dataUrl2Blob:e=>{for(var t=e.split(",")[0].split(":")[1].split(";")[0],a=atob(e.split(",")[1]),e=new ArrayBuffer(a.length),n=new Uint8Array(e),c=0;c<a.length;c++)n[c]=a.charCodeAt(c);return new Blob([n],{type:t})},blob2DataUrl:(e,t)=>{var a=new FileReader;a.onload=function(e){t(e.target.result)},a.readAsDataURL(e)},read:a=>new Promise((t,e)=>{caches.match(new Request("https://LOCALCACHE/"+encodeURIComponent(a))).then(function(e){e.text().then(e=>t(e))}).catch(()=>{t(null)})}),write:(a,n)=>new Promise((t,e)=>{caches.open(Jian.cache.name).then(function(e){e.delete(new Request("https://LOCALCACHE/"+encodeURIComponent(a))).then(function(){e.put(new Request("https://LOCALCACHE/"+encodeURIComponent(a)),new Response(n))}).catch(),t()}).catch(()=>{e()})}),getFile:(n,...c)=>new Promise((a,e)=>{Jian.cache.read(n).then(function(t){t?(fetch(n).then(function(e){e.blob().then(function(e){Jian.cache.blob2DataUrl(e,function(e){Jian.cache.write(n,e)})}).catch(function(){})}).catch(function(){}),a("can't cache"===t?{url:n,args:[...c]}:{url:URL.createObjectURL(Jian.cache.dataUrl2Blob(t)),args:[...c]})):fetch(n).then(function(e){e.blob().then(function(e){Jian.cache.blob2DataUrl(e,function(e){Jian.cache.write(n,e)}),a({url:URL.createObjectURL(Jian.cache.dataUrl2Blob(t)),args:[...c]})}).catch(function(e){Jian.cache.write(n,"can't cache"),a({url:n,err:e,args:[...c]})})}).catch(function(e){Jian.cache.write(n,"can't cache"),a({url:n,err:e,args:[...c]})})})})}</script><header class=header id=header><div class=blog-logo><a href=/ class=logo>动荡の初二少年</a></div><nav class=navbar><ul class=menu><li class=menu-item><a href=/ class=menu-item-link>首页</a></li><li class=menu-item><a href=/friends/ class=menu-item-link>友链</a></li><li class=menu-item><a href=/tags/ class=menu-item-link>标签</a></li><li class=menu-item><a href=javascript:Jian.dark.change() class=menu-item-link><i class="fa-regular fa-moon"></i></a></li></ul></nav></header><div class=msg id=msg></div><main class="main w-full grid page-main"><article class="cm9 c9 p9 m12"><div class="headimg card"><img src=https://npm.elemecdn.com/ytblogimg/10d48e3d7a300fa07a3bc2babf130321.svg></div><div class="card main"><div class=title><h1>FastJump.js</h1></div><div class=info><div class=metas><span class=meta><a href=https://www.yt-blog.top/about/ ><span>动荡の初二少年</span></a></span> <span class=meta><i class="fa-solid fa-calendar-alt"><span>2023-03-17 08:29:45</span></i></span> <span class=meta><i class="fa-solid fa-edit"><span>2023-05-25 13:19:16</span></i></span></div><hr style=border-color:#ddd></div><div class=content id=post><p>110行写了个小玩意，可以像sw那样离线缓存，和Pjax类似，不过用了自主缓存，fetch做请求，算了上代码吧：</p><pre><code class="highlight js">self.<span class=property>CACHE_NAME</span> = <span class=string>&#x27;FastJumpCache&#x27;</span>; <span class=comment>// 默认的存储名称</span>
self.<span class=property>db</span> = &#123;
    <span class=attr>read</span>: <span class=function>(<span class=params>key</span>) =&gt;</span> &#123;
        <span class=keyword>return</span> <span class=keyword>new</span> <span class="title class_">Promise</span>(<span class=function>(<span class=params>resolve, reject</span>) =&gt;</span> &#123;
            caches.<span class="title function_">match</span>(<span class=keyword>new</span> <span class="title class_">Request</span>(<span class=string>`https://LOCALCACHE/<span class=subst>$&#123;<span class=built_in>encodeURIComponent</span>(key)&#125;</span>`</span>)).<span class="title function_">then</span>(<span class=keyword>function</span> (<span class=params>res</span>) &#123;
                res.<span class="title function_">text</span>().<span class="title function_">then</span>(<span class=function><span class=params>text</span> =&gt;</span> <span class="title function_">resolve</span>(text));
            &#125;).<span class="title function_">catch</span>(<span class=function>() =&gt;</span> &#123;
                <span class="title function_">resolve</span>(<span class=literal>null</span>);
            &#125;);
        &#125;)
    &#125;, <span class=attr>write</span>: <span class=function>(<span class=params>key, value</span>) =&gt;</span> &#123;
        <span class=keyword>return</span> <span class=keyword>new</span> <span class="title class_">Promise</span>(<span class=function>(<span class=params>resolve, reject</span>) =&gt;</span> &#123;
            caches.<span class="title function_">open</span>(<span class="variable constant_">CACHE_NAME</span>).<span class="title function_">then</span>(<span class=keyword>function</span> (<span class=params>cache</span>) &#123;
                cache.<span class="title function_">put</span>(<span class=keyword>new</span> <span class="title class_">Request</span>(<span class=string>`https://LOCALCACHE/<span class=subst>$&#123;<span class=built_in>encodeURIComponent</span>(key)&#125;</span>`</span>), <span class=keyword>new</span> <span class="title class_">Response</span>(value));
                <span class="title function_">resolve</span>();
            &#125;).<span class="title function_">catch</span>(<span class=function>() =&gt;</span> &#123;
                <span class="title function_">reject</span>();
            &#125;);
        &#125;);
    &#125;
&#125;

<span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class=string>&#x27;DOMContentLoaded&#x27;</span>, <span class=keyword>function</span> (<span class=params></span>) &#123;
    self.<span class=property>db</span>.<span class="title function_">read</span>(<span class="variable language_">window</span>.<span class=property>location</span>.<span class=property>href</span>).<span class="title function_">then</span>(<span class=keyword>function</span> (<span class=params>d</span>) &#123;
        <span class=keyword>if</span> (!d) &#123;
            <span class="title function_">fetch</span>(<span class="variable language_">window</span>.<span class=property>location</span>.<span class=property>href</span>).<span class="title function_">then</span>(<span class=keyword>function</span> (<span class=params>d</span>) &#123;
                <span class=keyword>if</span> (d.<span class=property>headers</span>.<span class="title function_">get</span>(<span class=string>&#x27;content-type&#x27;</span>) === <span class=string>&#x27;text/html&#x27;</span>) &#123;
                    d.<span class="title function_">text</span>().<span class="title function_">then</span>(<span class=keyword>function</span> (<span class=params>b</span>) &#123;
                        self.<span class=property>db</span>.<span class="title function_">write</span>(<span class="variable language_">window</span>.<span class=property>location</span>.<span class=property>href</span>, b)
                    &#125;)
                &#125;
            &#125;)
        &#125;
    &#125;);
&#125;);

<span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class=string>&#x27;DOMContentLoaded&#x27;</span>, <span class=keyword>function</span> (<span class=params></span>) &#123;
    <span class=built_in>setInterval</span>(<span class=keyword>function</span> (<span class=params></span>) &#123;
        <span class=keyword>var</span> doms = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class=string>&#x27;a[href]&#x27;</span>);
        <span class="title class_">Array</span>.<span class=property><span class=keyword>prototype</span></span>.<span class=property>forEach</span>.<span class="title function_">call</span>(doms, <span class=keyword>function</span> (<span class=params>dom</span>) &#123;
            <span class=keyword>if</span> (dom.<span class=property>href</span> &amp;&amp; dom.<span class=property>href</span>.<span class="title function_">indexOf</span>(<span class="variable language_">window</span>.<span class=property>location</span>.<span class=property>origin</span>) === <span class=number>0</span>) &#123;
                dom.<span class=property>onclick</span> = <span class=keyword>function</span> (<span class=params></span>) &#123;
                    history.<span class="title function_">pushState</span>(&#123;&#125;, <span class=string>&#x27;&#x27;</span>, dom.<span class=property>href</span>);
                    self.<span class=property>db</span>.<span class="title function_">read</span>(dom.<span class=property>href</span>).<span class="title function_">then</span>(<span class=keyword>function</span> (<span class=params>d</span>) &#123;
                        <span class=keyword>if</span> (d) &#123;
                            <span class="variable language_">console</span>.<span class="title function_">clear</span>();
                            <span class="variable language_">document</span>.<span class="title function_">open</span>();
                            <span class=keyword>try</span> &#123;
                                <span class="variable language_">document</span>.<span class="title function_">write</span>(d);
                                <span class=keyword>let</span> <span class="title class_">Event</span>_timerun = <span class="variable language_">window</span>.<span class=built_in>setInterval</span>(<span class=keyword>function</span> (<span class=params></span>) &#123;
                                    <span class=keyword>if</span> (<span class="variable language_">document</span>.<span class=property>body</span>&amp;&amp;<span class="variable language_">document</span>.<span class=property>body</span>.<span class=property>innerHTML</span>) &#123;
                                        <span class=keyword>let</span> <span class="title class_">Event</span> = <span class=keyword>new</span> <span class="title class_">CustomEvent</span>(<span class=string>&#x27;onload&#x27;</span>)
                                        <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(<span class="title class_">Event</span>);
                                        <span class="variable language_">window</span>.<span class="title function_">dispatchEvent</span>(<span class="title class_">Event</span>);
                                        <span class="title class_">Event</span> = <span class=keyword>new</span> <span class="title class_">CustomEvent</span>(<span class=string>&#x27;DOMContentLoaded&#x27;</span>)
                                        <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(<span class="title class_">Event</span>);
                                        <span class="variable language_">window</span>.<span class="title function_">dispatchEvent</span>(<span class="title class_">Event</span>);
                                        <span class="variable language_">window</span>.<span class=built_in>clearInterval</span>(<span class="title class_">Event</span>_timerun)
                                    &#125;
                                &#125;,<span class=number>500</span>)
                                <span class="title function_">fetch</span>(dom.<span class=property>href</span>).<span class="title function_">then</span>(<span class=keyword>function</span> (<span class=params>d</span>) &#123;
                                    <span class=keyword>if</span> (d.<span class=property>headers</span>.<span class="title function_">get</span>(<span class=string>&#x27;content-type&#x27;</span>) === <span class=string>&#x27;text/html&#x27;</span>) &#123;
                                        d.<span class="title function_">text</span>().<span class="title function_">then</span>(<span class=keyword>function</span> (<span class=params>b</span>) &#123;
                                            self.<span class=property>db</span>.<span class="title function_">write</span>(<span class="variable language_">window</span>.<span class=property>location</span>.<span class=property>href</span>, b)
                                        &#125;)
                                    &#125;
                                &#125;)
                            &#125; <span class=keyword>catch</span> (e) &#123;

                            &#125;
                        &#125; <span class=keyword>else</span> &#123;
                            <span class="title function_">fetch</span>(dom.<span class=property>href</span>).<span class="title function_">then</span>(<span class=keyword>function</span> (<span class=params>d</span>) &#123;
                                <span class=keyword>if</span> (d.<span class=property>headers</span>.<span class="title function_">get</span>(<span class=string>&#x27;content-type&#x27;</span>) === <span class=string>&#x27;text/html&#x27;</span>) &#123;
                                    d.<span class="title function_">text</span>().<span class="title function_">then</span>(<span class=keyword>function</span> (<span class=params>b</span>) &#123;
                                        <span class="variable language_">console</span>.<span class="title function_">clear</span>();
                                        <span class="variable language_">document</span>.<span class="title function_">open</span>();
                                        <span class=keyword>try</span> &#123;
                                            <span class="variable language_">document</span>.<span class="title function_">write</span>(b)
                                            <span class=keyword>let</span> <span class="title class_">Event</span>_timerun = <span class="variable language_">window</span>.<span class=built_in>setInterval</span>(<span class=keyword>function</span> (<span class=params></span>) &#123;
                                                <span class=keyword>if</span> (<span class="variable language_">document</span>.<span class=property>body</span>&amp;&amp;<span class="variable language_">document</span>.<span class=property>body</span>.<span class=property>innerHTML</span>) &#123;
                                                    <span class=keyword>let</span> <span class="title class_">Event</span> = <span class=keyword>new</span> <span class="title class_">CustomEvent</span>(<span class=string>&#x27;onload&#x27;</span>)
                                                    <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(<span class="title class_">Event</span>);
                                                    <span class="variable language_">window</span>.<span class="title function_">dispatchEvent</span>(<span class="title class_">Event</span>);
                                                    <span class="title class_">Event</span> = <span class=keyword>new</span> <span class="title class_">CustomEvent</span>(<span class=string>&#x27;DOMContentLoaded&#x27;</span>)
                                                    <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(<span class="title class_">Event</span>);
                                                    <span class="variable language_">window</span>.<span class="title function_">dispatchEvent</span>(<span class="title class_">Event</span>);
                                                    <span class="variable language_">window</span>.<span class=built_in>clearInterval</span>(<span class="title class_">Event</span>_timerun)
                                                &#125;
                                            &#125;,<span class=number>500</span>)
                                        &#125; <span class=keyword>catch</span> (e) &#123;
                                        &#125;
                                        self.<span class=property>db</span>.<span class="title function_">write</span>(dom.<span class=property>href</span>, b)
                                    &#125;).<span class="title function_">catch</span>(<span class=keyword>function</span> (<span class=params>e</span>) &#123;
                                        <span class="variable language_">window</span>.<span class=property>location</span>.<span class=property>href</span> = dom.<span class=property>href</span>
                                    &#125;)
                                &#125;
                            &#125;).<span class="title function_">catch</span>(<span class=keyword>function</span> (<span class=params>e</span>) &#123;
                                <span class="variable language_">window</span>.<span class=property>location</span>.<span class=property>href</span> = dom.<span class=property>href</span>
                            &#125;)
                        &#125;
                    &#125;).<span class="title function_">catch</span>(<span class=keyword>function</span> (<span class=params>e</span>) &#123;
                        <span class="variable language_">window</span>.<span class=property>location</span>.<span class=property>href</span> = dom.<span class=property>href</span>
                    &#125;)
                    <span class=keyword>return</span> <span class=literal>false</span>;
                &#125;
            &#125;
        &#125;);
    &#125;, <span class=number>500</span>)
&#125;);</code></pre><p>注意不能与Pjax一起使用！！<br>鄙人水平有限，请斧正<br>有不少Bug，仅供测试，不可以在线上环境使用</p></div><div class=copyright><i class="fa-regular fa-copyright icon"></i><div class=text><p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p><p>本文永久链接是：<a href=https://www.yt-blog.top/64234/ >https://www.yt-blog.top/64234/</a></p></div></div></div><div class="card comments"><div id=waline><div style=display:flex;justify-content:center><span class=loading_i style="border-color:#3b82f6;margin:50px 0"></span></div></div><script>Jian.load.css("https://npm.elemecdn.com/@waline/client@2.14.7/dist/waline.css"),Jian.load.js("https://npm.elemecdn.com/@waline/client@2.14.7/dist/waline.js",function(){Waline.init({el:"#waline",path:window.location.pathname,serverURL:"https://waline.yt-blog.top"})})</script></div></article><div class="side c3 cm3 p3 m12"><div class=card><div class=header><a href=#><i class="">公告</i></a></div><div class="body type-text"><p>本站重新进行调试，开始使用自己的主题，过程中，可能会对使用略有影响</p><p><a href=/%E6%9A%82%E5%81%9C%E6%9B%B4%E6%96%B0/ >停更公告</a></p></div></div><script>Jian.load.css("https://npm.elemecdn.com/aplayer/dist/APlayer.min.css"),Jian.load.js("https://npm.elemecdn.com/aplayer/dist/APlayer.min.js",function(){Jian.load.js("https://npm.elemecdn.com/meting/dist/Meting.min.js")})</script><meting-js server=tencent type=playlist id=8318321951 class="side_music card"></meting-js><style>.side_music .aplayer{padding:0;border-radius:0;margin:0!important;background:#0000;box-shadow:none}.side_music .aplayer .aplayer-pic{height:50px;width:50px;border-radius:100%}.side_music .aplayer .aplayer-info{margin-left:50px;height:50px;padding:3px;border-bottom:0}.side_music .aplayer .aplayer-lrc{display:none}.side_music .aplayer .aplayer-list{display:none}.side_music{display:block;height:50px}</style><div class=card><div class=header><a href=/friends/ ><i class="fas fa-link">友链</i></a></div><div class=body id=QexoSideFriendsList style=display:flex;flex-wrap:wrap;flex-direction:row;justify-content:center><span class=loading_i style="border-color:#3b82f6;margin:50px 0"></span></div></div><script>function loadQexoFriends(t,e){e+="/pub/friends/";document.getElementById(t).className="friend-content",fetch(e).then(function(e){e.ok?e.json().then(function(e){if(e.status){var n=e.data;document.getElementById(t).innerHTML=`
 <style>
.Qfriends_line {
    width: 50px;
    height: 50px;
    padding: 5px;
    background: #fff0;
    border-radius: 5px !important;
    margin: 3px 0 !important;
    display: flex;
}
.Qfriends_line:hover {
        background: #a4a4a485 !important;
}
</style>`;for(let e=0;e<n.length;e++)document.getElementById(t).innerHTML+=`<li class="Qfriends_line"><a title="${n[e].name}" target="_blank" rel="noopener" href="${n[e].url}"><img lazyload="${n[e].image}" style="border-radius: 100%;width: 100%;height: 100%;"></a></li>`;document.getElementById(t).innerHTML+=""}else alert("友链载入失败!")}):alert("友链获取失败!")})}loadQexoFriends("QexoSideFriendsList","https://admin.yt-blog.top")</script></div></main><footer></footer></body></html>