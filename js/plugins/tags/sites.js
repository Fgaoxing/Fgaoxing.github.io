const SitesJS={requestAPI:(e,t,r)=>{let a=5;function n(){return new Promise((o,s)=>{let i=0,l=setTimeout(()=>{0===i&&(i=2,l=null,s("请求超时"),0==a&&r())},5e3);fetch(e).then(function(e){if(2!==i&&(clearTimeout(l),o(e),l=null,i=1),e.ok)return e.json();throw Error("Network response was not ok.")}).then(function(e){a=0,t(e)}).catch(function(e){a>0?(a-=1,setTimeout(()=>{n()},5e3)):r()})})}n()},layout:e=>{let t=e.el;SitesJS.requestAPI(e.api,function(r){t.querySelector(".loading-wrap").remove();let a=r.content;var n="";a.forEach((t,r)=>{var a='<div class="site-card">';a+='<a class="card-link" target="_blank" rel="external noopener noreferrer" href="'+t.url+'">'+('<img alt="'+t.title+'" src="')+(t.screenshot||"https://image.thum.io/get/width/1024/crop/768/"+t.url)+'" onerror="errorImgCover(this)"/><div class="info">'+('<img alt="'+t.title+'" src="')+(t.avatar||e.avatar)+'" onerror="errorImgAvatar(this)"/><span class="title">'+t.title+'</span><span class="desc">'+(t.description||t.url)+"</span></div></a></div>",n+=a}),t.querySelector(".group-body").innerHTML=n},function(){try{t.querySelector(".loading-wrap svg").remove(),t.querySelector(".loading-wrap p").innerText("加载失败，请稍后重试。")}catch(e){}})},start:e=>{let t=document.getElementsByClassName("sitesjs-wrap");for(var r=0;r<t.length;r++){let a=t[r],n=a.getAttribute("api");if(null!=n){var e={};e.class=a.getAttribute("class"),e.el=a,e.api=n,e.avatar=volantis.GLOBAL_CONFIG.default.link,e.screenshot=volantis.GLOBAL_CONFIG.default.cover,SitesJS.layout(e)}}}};SitesJS.start(),document.addEventListener("pjax:complete",function(){SitesJS.start()});